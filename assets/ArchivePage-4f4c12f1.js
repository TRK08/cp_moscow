import{H as M,P as q,u as D,a as A}from"./VideoPlayer.vue_vue_type_style_index_0_lang-591c230c.js";import{d as V,k as O,l as G,m as J,o as a,c as x,u as U,n as k,r as l,e as _,w as s,g as o,a as f,p as K,t as y,h as Q,q as w,v as W,s as F,x as X,f as p,F as P,y as T}from"./index-1454946b.js";const Y=V({__name:"VideoPlayer",props:{path:{}},setup(u){const e=u,t=O(null),n=new M;return G(()=>{const r=t.value,d=`https://89.232.165.248.sslip.io:9002/${e.path}`;M.isSupported()&&r&&(n.loadSource(d),n.attachMedia(r),n.on(M.Events.MANIFEST_PARSED,function(){r.volume=0,r.play()}),q.setup(r))}),J(()=>{n.destroy()}),(r,d)=>(a(),x("video",{class:"video__player",ref_key:"video",ref:t,width:"100%",height:"640",controls:""},null,512))}}),Z=["title"],tt={key:0},et=V({__name:"ArchiveCard",props:{archiveItem:{}},emits:["more"],setup(u,{emit:e}){D(),U();const t=u,n=e,r={processing:{text:"Файл обрабатывается",color:"#FCE83A"},completed:{text:"Обработка завершена",color:"#56F000"}},d=k(()=>r[t.archiveItem.status]),I=k(()=>{const h=new Date(t.archiveItem.created);return h.setMinutes(h.getMinutes()-h.getTimezoneOffset()),h.toLocaleString()});return(h,g)=>{const v=l("n-space"),C=l("n-button"),S=l("n-card");return a(),_(S,{hoverable:"",style:{cursor:"pointer",overflow:"hidden"}},{action:s(()=>[o(v,{justify:"space-between",align:"center"},{default:s(()=>[o(v,{"wrap-item":!1,align:"center",class:"archive-card__status"},{default:s(()=>[f("span",{class:"archive-card__status-icon",style:K({backgroundColor:d.value.color})},null,4),f("small",null,y(d.value.text),1)]),_:1}),o(v,null,{default:s(()=>[o(C,{round:"",type:"primary",onClick:g[0]||(g[0]=$=>n("more",t.archiveItem.id))},{default:s(()=>[Q(" Подробнее ")]),_:1})]),_:1})]),_:1})]),default:s(()=>[o(v,{vertical:"","wrap-item":!1},{default:s(()=>[f("p",{class:"archive-card__name",title:t.archiveItem.name},"Файл: "+y(t.archiveItem.name),9,Z),f("small",null,"Дата: "+y(I.value),1),t.archiveItem.popular?(a(),x("span",tt,"Категория: "+y(t.archiveItem.popular),1)):w("",!0)]),_:1})]),_:1})}}});const z=W("archive",{state:()=>({fetchStatus:"init",archive:[],archiveCard:null}),actions:{async getArchive(){var u;try{const e=await A.get("https://89.232.165.248.sslip.io/api/v1/ml/list");if(e)return this.archive=e.data.reverse(),this.archive}catch(e){if(this.fetchStatus="error",A.isAxiosError(e))return console.log(e),{status:this.fetchStatus,code:(u=e.response)==null?void 0:u.status}}finally{this.fetchStatus="init"}},async getArchiveCard(u){var e;try{const t=await A.get(`https://89.232.165.248.sslip.io/api/v1/ml/get?id=${u}`);if(t)return this.archiveCard=t.data,this.archiveCard}catch(t){if(this.fetchStatus="error",A.isAxiosError(t))return console.log(t),{status:this.fetchStatus,code:(e=t.response)==null?void 0:e.status}}finally{this.fetchStatus="init"}}}}),st=["src"],ot=V({__name:"ArchivePage",setup(u){const{videoPath:e}=F(D()),{archive:t,archiveCard:n,fetchStatus:r}=F(z()),{getArchive:d,getArchiveCard:I}=z(),h=U(),g=async()=>{const m=await d();(m==null?void 0:m.status)==="error"&&h.error({content:"Не удалось загрузить архив",duration:3e3})},v=async m=>{const i=await I(m);(i==null?void 0:i.status)==="error"&&h.error({content:"Что-то пошло не так",duration:3e3})},C=k(()=>!!e.value),S=k(()=>!!n.value),$=()=>{n.value=null,g()};return X(()=>{g()}),(m,i)=>{const j=l("n-spin"),b=l("n-gi"),N=l("n-grid"),B=l("n-modal"),H=l("n-space"),L=l("n-card"),R=l("n-scrollbar");return a(),x(P,null,[p(r)==="loading"?(a(),_(j,{key:0,size:"large",style:{width:"100%"}})):w("",!0),p(t).length>0?(a(),_(N,{key:1,cols:"2 800:3","x-gap":"16","y-gap":"16"},{default:s(()=>[(a(!0),x(P,null,T(p(t),c=>(a(),_(b,{key:c.id},{default:s(()=>[o(et,{archiveItem:c,onMore:v},null,8,["archiveItem"])]),_:2},1024))),128))]),_:1})):w("",!0),o(B,{show:C.value,"onUpdate:show":i[0]||(i[0]=c=>C.value=c),preset:"card",style:{width:"fit-content","min-width":"50vw","min-height":"300px"},onClose:i[1]||(i[1]=c=>e.value=null)},{default:s(()=>[p(e)?(a(),_(Y,{key:0,path:p(e)},null,8,["path"])):w("",!0)]),_:1},8,["show"]),o(B,{show:S.value,"onUpdate:show":i[2]||(i[2]=c=>S.value=c),preset:"card",style:{width:"fit-content","min-width":"90vw",height:"100%","max-height":"90vh",overflow:"hidden"},onClose:$},{default:s(()=>[p(n)?(a(),_(R,{key:0,style:{"max-height":"80vh"}},{default:s(()=>[o(N,{cols:"4","x-gap":"16","y-gap":"16"},{default:s(()=>{var c;return[(a(!0),x(P,null,T((c=p(n))==null?void 0:c.screenshots,E=>(a(),_(b,{key:E.id},{default:s(()=>[o(L,{style:{"min-height":"300px",overflow:"hidden"}},{cover:s(()=>[f("img",{src:`https://89.232.165.248.sslip.io:9002/static/${E.path}`},null,8,st)]),action:s(()=>[o(H,{vertical:"",justify:"start",align:"center"},{default:s(()=>[f("span",null,"Тип отходов: "+y(E.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1})]),_:1})):w("",!0)]),_:1},8,["show"])],64)}}});export{ot as default};
